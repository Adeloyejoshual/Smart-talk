// public/scripts/home.js
document.addEventListener("DOMContentLoaded", () => {
  const usernameDisplay = document.getElementById("usernameDisplay");
  const searchBar = document.getElementById("searchBar");
  const userList = document.getElementById("userList");
  const addUserBtn = document.getElementById("addUserBtn");
  const settingsBtn = document.getElementById("settingsBtn");
  const settingsMenu = document.getElementById("settingsMenu");
  const darkToggle = document.getElementById("darkModeToggle");

  // Get current user from cookie or localStorage
  const user = JSON.parse(localStorage.getItem("user"));
  if (!user) return (window.location.href = "/login.html");

  usernameDisplay.textContent = user.username;

  // Load users initially
  fetchUsers("");

  // Search bar listener
  searchBar.addEventListener("input", () => {
    fetchUsers(searchBar.value.trim());
  });

  function fetchUsers(search) {
    fetch(`/api/users?search=${search}&current=${user.username}`)
      .then(res => res.json())
      .then(data => {
        userList.innerHTML = "";
        if (data.length === 0) {
          userList.innerHTML = "<p>No users found</p>";
        } else {
          data.forEach(u => {
            const div = document.createElement("div");
            div.className = "user";
            div.textContent = u.username + " (" + u.email + ")";
            userList.appendChild(div);
          });
        }
      });
  }

  // Floating buttons
  addUserBtn.addEventListener("click", () => {
    window.location.href = "/register.html";
  });

  settingsBtn.addEventListener("click", () => {
    settingsMenu.classList.toggle("hidden");
  });

  // Dark mode toggle
  darkToggle.addEventListener("change", () => {
    document.body.classList.toggle("dark-mode", darkToggle.checked);
  });
});