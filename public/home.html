<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>SmartTalk - Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/styles/home.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
  <header>
    <h2 id="welcomeUser">Welcome</h2>
    <div class="right-header">
      <input type="text" id="searchInput" placeholder="Search users..." />
      <button id="themeToggle" title="Toggle Theme"><i class="fas fa-moon"></i></button>
      <button id="settingsBtn" title="Settings"><i class="fas fa-cog"></i></button>
    </div>
  </header>

  <main>
    <section id="userList" class="user-list">
      <!-- Users will be dynamically listed here -->
    </section>

    <!-- Settings Panel -->
    <div id="settingsPanel" class="settings-panel hidden">
      <div class="settings-header">
        <button id="backToHome" class="back-btn"><i class="fas fa-arrow-left"></i></button>
        <h3>Settings</h3>
      </div>
      <ul class="settings-options">
        <li><a href="/profile.html"><i class="fas fa-user-edit"></i> Edit Profile</a></li>
        <li><a href="/contact.html"><i class="fas fa-headset"></i> Customer Service</a></li>
        <li><a href="mailto:smarttalkgit@gmail.com"><i class="fas fa-envelope"></i> Contact</a></li>
        <li><a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
      </ul>
    </div>

    <!-- Floating Add User Button -->
    <button id="addUserBtn" class="floating-add-btn" title="Add New User">
      <i class="fas fa-plus"></i>
    </button>
  </main>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/scripts/home.js"></script>
</body>
</html><!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>SmartTalk - Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/styles/home.css" />
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <header>
    <h2>SmartTalk</h2>
    <div class="header-right">
      <input type="text" id="searchInput" placeholder="Search users..." />
      <button id="themeToggle">üåô</button>
      <button id="settingsBtn">‚öôÔ∏è</button>
    </div>
  </header>

  <main>
    <h3 id="welcomeUser">Welcome, User</h3>
    <div id="userList" class="user-list"></div>
  </main>

  <button id="addFriendBtn">Ôºã</button>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <h4>Settings</h4>
      <ul>
        <li><a href="/profile.html">Edit Profile</a></li>
        <li><a href="/contact.html">Customer Service</a></li>
        <li><a href="mailto:smarttalkgit@gmail.com">Contact</a></li>
        <li><a href="#" id="logoutBtn">Logout</a></li>
      </ul>
    </div>
  </div>

  <script>
    const token = localStorage.getItem("token");
    const user = JSON.parse(localStorage.getItem("user"));
    if (!token || !user) window.location.href = "/login.html";

    document.getElementById("welcomeUser").innerText = `Welcome, ${user.username}`;
    
    const socket = io();
    socket.emit("userOnline", user._id);

    const userList = document.getElementById("userList");
    const searchInput = document.getElementById("searchInput");

    function fetchUsers(query = "") {
      fetch(`/api/users/search?q=${query}`, {
        headers: { Authorization: `Bearer ${token}` }
      })
      .then(res => res.json())
      .then(users => {
        userList.innerHTML = "";
        users.forEach(u => {
          if (u._id !== user._id) {
            const div = document.createElement("div");
            div.className = "user-card";
            div.innerText = u.username;
            div.addEventListener("click", () => {
              localStorage.setItem("receiverId", u._id);
              localStorage.setItem("receiverUsername", u.username);
              window.location.href = "/chat.html";
            });
            userList.appendChild(div);
          }
        });
      });
    }

    fetchUsers();
    searchInput.addEventListener("input", () => {
      fetchUsers(searchInput.value);
    });

    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.clear();
      window.location.href = "/login.html";
    });

    document.getElementById("themeToggle").addEventListener("click", () => {
      const html = document.documentElement;
      const isDark = html.getAttribute("data-theme") === "dark";
      html.setAttribute("data-theme", isDark ? "light" : "dark");
    });

    document.getElementById("settingsBtn").addEventListener("click", () => {
      document.getElementById("settingsModal").style.display = "block";
    });

    window.onclick = (e) => {
      const modal = document.getElementById("settingsModal");
      if (e.target === modal) modal.style.display = "none";
    };

    document.getElementById("addFriendBtn").addEventListener("click", () => {
      const newUsername = prompt("Enter username to add:");
      if (!newUsername) return;
      fetch("/api/users/add", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({ username: newUsername })
      })
      .then(res => res.json())
      .then(data => {
        alert(data.message || "User added.");
        fetchUsers();
      });
    });
  </script>
</body>
</html>