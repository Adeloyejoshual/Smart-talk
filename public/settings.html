<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Settings - SmartTalk</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white transition-colors duration-300">
    <div class="max-w-md mx-auto px-4 py-6">
      <!-- Profile Picture -->
      <div class="flex flex-col items-center gap-3">
        <label for="avatarInput" class="cursor-pointer">
          <img
            id="avatarPreview"
            src="default.jpg"
            class="w-24 h-24 rounded-full border-2 border-gray-300 dark:border-white object-cover"
            alt="Profile Picture"
          />
        </label>
        <input type="file" id="avatarInput" accept="image/*" class="hidden" />
        <p id="username" class="text-lg font-bold"></p>
        <p id="email" class="text-sm text-gray-500 dark:text-gray-300"></p>
      </div>

      <!-- Divider -->
      <hr class="my-6 border-gray-300 dark:border-gray-600" />

      <!-- Options -->
      <div class="flex flex-col space-y-4">
        <a href="#" class="block w-full text-center bg-green-600 text-white py-2 rounded-lg">Invite Friends</a>
        <a href="contact.html" class="block w-full text-center bg-blue-600 text-white py-2 rounded-lg">Contact</a>
        <button
          onclick="logout()"
          class="w-full bg-red-500 text-white py-2 rounded-lg"
        >
          Logout
        </button>
      </div>
    </div>

    <script>
      const token = localStorage.getItem("token");
      const headers = { Authorization: "Bearer " + token };

      // Load user profile
      async function loadProfile() {
        const res = await fetch("/api/users/me", { headers });
        const data = await res.json();
        document.getElementById("username").innerText = data.username;
        document.getElementById("email").innerText = data.email;
        document.getElementById("avatarPreview").src = data.avatar || "default.jpg";
      }

      // Upload image when selected
      document.getElementById("avatarInput").addEventListener("change", async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const formData = new FormData();
        formData.append("avatar", file);

        const res = await fetch("/api/users/upload-avatar", {
          method: "POST",
          headers,
          body: formData,
        });

        const result = await res.json();
        if (result.avatar) {
          document.getElementById("avatarPreview").src = result.avatar;
        } else {
          alert("Upload failed");
        }
      });

      // Logout
      function logout() {
        localStorage.removeItem("token");
        window.location.href = "/login.html";
      }

      // Dark mode toggle from localStorage
      if (localStorage.getItem("darkToggle") === "true") {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }

      loadProfile();
    </script>
  </body>
</html>